<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - materials - standard</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background:#000;
				color:#fff;
				padding:0;
				margin:0;
				font-weight: bold;
				overflow:hidden;
			}
			a {	color: #ffffff;	}
			#info {
				position: absolute;
				top: 0px; width: 100%;
				color: #ffffff;
				padding: 5px;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				z-index:1000;
			}
			#oldie {
				background:rgb(200,100,0) !important;
				color:#fff;
			}
			#vt { display:none }
			#vt, #vt a { color:orange; }
		</style>

		<body>
		<div id="info">
		</div>

		<script src="js/three.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/OBJLoader.js"></script>

		<script src="js/RGBELoader.js"></script>
		<script src="js/HDRCubeTextureLoader.js"></script>

		<script src="js/PMREMGenerator.js"></script>
		<script src="js/PMREMCubeUVPacker.js"></script>

		<script src="js/Detector.js"></script>

		<script>

		if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

		var container, loader;

		var camera, scene, renderer;

		var controls;

		var mesh;

		var spotLight;

		init();

		animate();

		function init() {

			container();

			renderer();

			scene();

			camera();

			controls();

			scene.add( new THREE.HemisphereLight( 0x443333, 0x222233, 4 ) );

			new THREE.CubeTextureLoader()
					.setPath( 'textures/cube/pisa/' )
					.load( [ 'px.png', 'nx.png', 'py.png', 'ny.png', 'pz.png', 'nz.png' ], function ( textureCube ) {
						scene.background = textureCube;
					} );

			var material = new THREE.MeshStandardMaterial();

			new THREE.OBJLoader()
					.setPath( 'models/obj/cerberus/' )

			.load( 'Cerberus.obj', function ( group ) {
						var loader = new THREE.TextureLoader()
							.setPath( 'models/obj/cerberus/' );

			material.roughness = 1; // 粗糙度
			material.metalness = 1; // 金属光泽度

			material.map = loader.load( 'Cerberus_A.jpg' );

			material.metalnessMap = material.roughnessMap = loader.load( 'Cerberus_RM.jpg' );
			material.normalMap = loader.load( 'Cerberus_N.jpg' );


			material.map.wrapS = THREE.RepeatWrapping;
			material.roughnessMap.wrapS = THREE.RepeatWrapping;
			material.metalnessMap.wrapS = THREE.RepeatWrapping;
			material.normalMap.wrapS = THREE.RepeatWrapping;

			group.traverse( function ( child ) {
							if ( child instanceof THREE.Mesh ) {
								child.material = material;
							}
						} );
						group.position.x = - 0.45;
						group.rotation.y = - Math.PI / 2;
						scene.add( group );
					} );
		    
		    var genCubeUrls = function( prefix, postfix ) {
					return [
						prefix + 'px' + postfix, prefix + 'nx' + postfix,
						prefix + 'py' + postfix, prefix + 'ny' + postfix,
						prefix + 'pz' + postfix, prefix + 'nz' + postfix
					];
				};

            var hdrUrls = genCubeUrls( 'img/cube/', '.hdr' );
			new THREE.HDRCubeTextureLoader().load( THREE.UnsignedByteType, hdrUrls, function ( hdrCubeMap ) {
					
					var pmremGenerator = new THREE.PMREMGenerator( hdrCubeMap );
					pmremGenerator.update( renderer );
					
					var pmremCubeUVPacker = new THREE.PMREMCubeUVPacker( pmremGenerator.cubeLods );
					pmremCubeUVPacker.update( renderer );
					
					var hdrCubeRenderTarget = pmremCubeUVPacker.CubeUVRenderTarget;
					
					material.envMap = hdrCubeRenderTarget.texture;
					material.needsUpdate = true; 
					
					hdrCubeMap.dispose();
					pmremGenerator.dispose();
					pmremCubeUVPacker.dispose();
				} );


				if ( statsEnabled ) {
					stats = new Stats();
					container.appendChild( stats.dom );
				}

				window.addEventListener( 'resize', onWindowResize, false );
		    }

		function onWindowResize( event ) {
				renderer.setSize( window.innerWidth, window.innerHeight );
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
		}

		function container(){
        		container = document.createElement( 'div' );
				document.body.appendChild( container );
        }

        function renderer(){
        		//打开抗齿距
        		renderer = new THREE.WebGLRenderer( { antialias: true } );

        		//兼容高清屏
				renderer.setPixelRatio( window.devicePixelRatio );


				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				renderer.gammaInput = true;//如果设置，那么它预计所有的纹理和颜色都是预乘伽马。默认为false。
				renderer.gammaOutput = true;//如果设置，那么它预计所有的纹理和颜色需要以预乘伽马输出。默认为false。
				renderer.toneMapping = THREE.ReinhardToneMapping;
				renderer.toneMappingExposure = 3;//色调映射的曝光级别

        }

        function scene(){
        		scene=new THREE.Scene();
        }

        function camera(){
        		camera=new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.01, 1000);
        		camera.position.z = 2;
        	}

        function scene(){
        		scene=new THREE.Scene();
        }

        function light(){      		
			    let ambient = new THREE.AmbientLight( 0x666666 );
				scene.add( ambient );

				let directionalLight = new THREE.DirectionalLight( 0x887766 );
				directionalLight.position.set( -1, 1, 1 ).normalize();
				scene.add( directionalLight );
        }

        function controls(){
        	controls = new THREE.OrbitControls( camera, renderer.domElement );
        }

        	//
			function animate() {
				requestAnimationFrame( animate );
				renderer.render( scene, camera );
				if ( statsEnabled ) stats.update();
			}
		</script>

	</body>
</html>
